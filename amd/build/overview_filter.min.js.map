{"version":3,"file":"overview_filter.min.js","sources":["../src/overview_filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Overview table filter.\n *\n * @module  block_completion_progress/overview_filter\n * @copyright 2021 Tomo Tsuyuki <tomotsuyuki@catalyst-au.net>\n * @copyright 2025 Jonathon Fowler <fowlerj@usq.edu.au>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport CourseFilter from 'core/datafilter/filtertypes/courseid';\nimport DataFilter from 'core/datafilter';\nimport DataFilterSelectors from 'core/datafilter/selectors';\nimport * as DynamicTable from 'core_table/dynamic';\nimport Notification from 'core/notification';\nimport BlockInstanceFilter from 'block_completion_progress/datafilter/filtertypes/blockinstanceid';\n\n/**\n * Initialise the overview table filter.\n * @param {String} filterRegionId The id of the filter element.\n * @param {Object} initialFilters Initial filters configuration.\n */\nexport const init = async(filterRegionId, initialFilters) => {\n    const filterSet = document.querySelector(`#${filterRegionId}`);\n\n    const applyFilters = (filters, pendingPromise) => {\n        DynamicTable\n            .setFilters(\n                DynamicTable.getTableFromId(filterSet.dataset.tableRegion),\n                {\n                    jointype: parseInt(filterSet.querySelector(DataFilterSelectors.filterset.fields.join).value, 10),\n                    filters,\n                }\n            )\n            .then(result => {\n                pendingPromise.resolve();\n                return result;\n            })\n            .catch(Notification.exception);\n    };\n\n    const dataFilter = new DataFilter(filterSet, applyFilters);\n    dataFilter.activeFilters.courseid = new CourseFilter('courseid', filterSet);\n    dataFilter.activeFilters.blockinstanceid = new BlockInstanceFilter('blockinstanceid', filterSet,\n        initialFilters.filters.blockinstanceid.values[0]);\n    dataFilter.init();\n\n    // This line does not update the overall any/all/none UI control and I do not understand why, yet. Very little of\n    // the promise acrobatics in user/amd/src/participants_filter.js makes sense frankly, but the code of\n    // question/amd/src/filter.js is a bit more comprehensible.\n    filterSet.querySelector(DataFilterSelectors.filterset.fields.join).value = initialFilters.jointype;\n\n    let emptyFilterRow = filterSet.querySelector(DataFilterSelectors.filterset.regions.emptyFilterRow);\n    let rownum = 1;\n    for (let f in initialFilters.filters) {\n        let fil = initialFilters.filters[f];\n        switch (fil.name) {\n            case 'courseid':\n            case 'blockinstanceid':\n                break;\n            default:\n                if (emptyFilterRow) {\n                    emptyFilterRow.remove();\n                    emptyFilterRow = undefined;\n                }\n                dataFilter.addFilterRow({\n                    filtertype: fil.name,\n                    values: fil.values,\n                    jointype: fil.jointype,\n                    rownum: rownum,\n                });\n                rownum++;\n                break;\n        }\n    }\n};\n"],"names":["async","filterRegionId","initialFilters","filterSet","document","querySelector","dataFilter","DataFilter","filters","pendingPromise","DynamicTable","setFilters","getTableFromId","dataset","tableRegion","jointype","parseInt","DataFilterSelectors","filterset","fields","join","value","then","result","resolve","catch","Notification","exception","activeFilters","courseid","CourseFilter","blockinstanceid","BlockInstanceFilter","values","init","emptyFilterRow","regions","rownum","f","fil","name","remove","undefined","addFilterRow","filtertype"],"mappings":";;;;;;;;ggCAoCoBA,MAAMC,eAAgBC,wBAChCC,UAAYC,SAASC,yBAAkBJ,iBAkBvCK,WAAa,IAAIC,oBAAWJ,WAhBb,CAACK,QAASC,kBAC3BC,aACKC,WACGD,aAAaE,eAAeT,UAAUU,QAAQC,aAC9C,CACIC,SAAUC,SAASb,UAAUE,cAAcY,mBAAoBC,UAAUC,OAAOC,MAAMC,MAAO,IAC7Fb,QAAAA,UAGPc,MAAKC,SACFd,eAAee,UACRD,UAEVE,MAAMC,sBAAaC,cAI5BrB,WAAWsB,cAAcC,SAAW,IAAIC,kBAAa,WAAY3B,WACjEG,WAAWsB,cAAcG,gBAAkB,IAAIC,yBAAoB,kBAAmB7B,UAClFD,eAAeM,QAAQuB,gBAAgBE,OAAO,IAClD3B,WAAW4B,OAKX/B,UAAUE,cAAcY,mBAAoBC,UAAUC,OAAOC,MAAMC,MAAQnB,eAAea,aAEtFoB,eAAiBhC,UAAUE,cAAcY,mBAAoBC,UAAUkB,QAAQD,gBAC/EE,OAAS,MACR,IAAIC,KAAKpC,eAAeM,QAAS,KAC9B+B,IAAMrC,eAAeM,QAAQ8B,UACzBC,IAAIC,UACH,eACA,gCAGGL,iBACAA,eAAeM,SACfN,oBAAiBO,GAErBpC,WAAWqC,aAAa,CACpBC,WAAYL,IAAIC,KAChBP,OAAQM,IAAIN,OACZlB,SAAUwB,IAAIxB,SACdsB,OAAQA,SAEZA"}