{"version":3,"file":"overview.min.js","sources":["../src/overview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Completion Progress overview page behaviour.\n *\n * @module     block_completion_progress/overview\n * @copyright  2020 Jonathon Fowler <fowlerj@usq.edu.au>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport * as PubSub from 'core/pubsub';\nimport {showAddNote, showSendMessage} from 'core_user/local/participants/bulkactions';\n\nconst tablesel = '.table-dynamic[data-table-component=\"block_completion_progress\"]' +\n        '[data-table-handler=\"overview\"]';\n\nexport const init = (courseid, noteStateNames) => {\n    const page = document.getElementById('page');\n\n    // Listen for submissions on the download form and copy the filters in.\n    page.addEventListener('submit', function(e) {\n        if (!e.target.matches('form.dataformatselector')) {\n            return;\n        }\n        var filtersetel = e.target.elements.filterset || (function() {\n            var el = document.createElement('INPUT');\n            el.type = 'hidden';\n            el.name = 'filterset';\n            e.target.appendChild(el);\n            return el;\n        })();\n        filtersetel.value = document.querySelector(tablesel).dataset.tableFilters;\n    });\n\n    // Listen for togglegroup checkboxes changing state and enable/disable bulk action buttons.\n    PubSub.subscribe('core/checkbox-toggleall:checkboxToggled', function(e) {\n        var buttons = document.querySelectorAll('[data-table-component=\"block_completion_progress\"] .bulkactions button');\n        buttons.forEach(n => void (n.disabled = !e.anyChecked));\n    });\n\n    /**\n     * Operate the bulk messaging/note functions.\n     * @copyright 2017 Damyon Wiese\n     */\n    page.addEventListener('click', function(e) {\n        let bulkAction;\n        const checkboxes = document.querySelectorAll(\"input[data-togglegroup='overview-table'][data-toggle='slave']:checked,\" +\n            \"input[data-togglegroup='overview-table'][data-toggle='target']:checked\");\n        const noteHelpIcon = document.querySelector('[data-region=\"state-help-icon\"]');\n        const ids = [];\n        checkboxes.forEach(checkbox => {\n            ids.push(checkbox.getAttribute('name').replace('user', ''));\n        });\n\n        if (e.target.id === 'sendmessage') {\n            bulkAction = showSendMessage(ids);\n        } else if (e.target.id === 'addnote') {\n            bulkAction = showAddNote(courseid, ids, noteStateNames, noteHelpIcon);\n        }\n        if (bulkAction) {\n            const pendingBulkAction = new Pending('core_user/participants:bulkActionSelected');\n            bulkAction.then(modal => {\n                pendingBulkAction.resolve();\n                return modal;\n            }).catch(Notification.exception);\n        }\n    });\n};\n"],"names":["courseid","noteStateNames","page","document","getElementById","addEventListener","e","el","target","matches","elements","filterset","createElement","type","name","appendChild","value","querySelector","dataset","tableFilters","PubSub","subscribe","querySelectorAll","forEach","n","disabled","anyChecked","bulkAction","checkboxes","noteHelpIcon","ids","checkbox","push","getAttribute","replace","id","pendingBulkAction","Pending","then","modal","resolve","catch","Notification","exception"],"mappings":";;;;;;;01BA+BoB,CAACA,SAAUC,wBACrBC,KAAOC,SAASC,eAAe,QAGrCF,KAAKG,iBAAiB,UAAU,SAASC,OAK7BC,GAJHD,EAAEE,OAAOC,QAAQ,8BAGJH,EAAEE,OAAOE,SAASC,aAC5BJ,GAAKJ,SAASS,cAAc,UAC7BC,KAAO,SACVN,GAAGO,KAAO,YACVR,EAAEE,OAAOO,YAAYR,IACdA,KAECS,MAAQb,SAASc,cAlBpB,mGAkB4CC,QAAQC,iBAIjEC,OAAOC,UAAU,2CAA2C,SAASf,GACnDH,SAASmB,iBAAiB,0EAChCC,SAAQC,IAAWA,EAAEC,UAAYnB,EAAEoB,iBAO/CxB,KAAKG,iBAAiB,SAAS,SAASC,OAChCqB,iBACEC,WAAazB,SAASmB,iBAAiB,gJAEvCO,aAAe1B,SAASc,cAAc,mCACtCa,IAAM,MACZF,WAAWL,SAAQQ,WACfD,IAAIE,KAAKD,SAASE,aAAa,QAAQC,QAAQ,OAAQ,QAGvC,gBAAhB5B,EAAEE,OAAO2B,GACTR,YAAa,gCAAgBG,KACN,YAAhBxB,EAAEE,OAAO2B,KAChBR,YAAa,4BAAY3B,SAAU8B,IAAK7B,eAAgB4B,eAExDF,WAAY,OACNS,kBAAoB,IAAIC,iBAAQ,6CACtCV,WAAWW,MAAKC,QACZH,kBAAkBI,UACXD,SACRE,MAAMC,sBAAaC"}